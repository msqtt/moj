## 需求说明

### 简要说明

本项目是一个在线编程题平台，核心的服务有：

- 编辑题目与样例
- 提交代码判题
- 限时比赛场景


项目背景：假设开发一个 OJ 系统用于大学科技社团的招新考核，已知每年约有 800 人(一个年级)报名参加科技社团的招新考核，其中约有 10% 的人每天参加 OJ 日常刷题训练，约有 90% 人会报名参加招新考试。招新考试时长约为2.5h。


### 非功能需求

#### 判题并发指标

由于日常刷题训练的用户只占比 10% ， 考核用户占比 90%，因此系统主要的访问量集中在比赛场景。

我们假设最拥挤的情况下， 800 人参与同一场招新考试，假设考试期间每人平均 10s 提交一次判题。

(800 * (2.5 * 60 * 60) / 10 ) / (2.5 * 60 * 60) = **80 QPS**

即在考试期间，系统的判题请求会达到 **80+ QPS** 。

假设所有题目运行需要最大内存为 256 MB。

Run Server 需求：
- 内存： 80 * 256 / 1024 = 20 GB
- 核心：
    - 假设平均每个判题任务平均需要 600ms CPU 题
    - 80 * 600 / 1000 = 48

至少需要 20 GB 内存，48 线程的计算资源
> 使用分布式集群，至少约需要 6 台 4核8线程/4G 的计算单元。


#### 页面指标

由此可以从理论上判断出， IO/数据库 不会成为该系统最主要的性能瓶颈。

页面访问最多仅需要 **800 QPS**

#### 简单分析

综合考虑比赛判题场景下并发量与页面访问量，
可以考虑把判题相关业务划分到一个服务边界内，而把其他业务划分到另一个服务边界，即：使用 SOA 架构，同时考虑到判题的资源需求，使用分布式集群来构建判题服务以降低硬件成本。


### 功能需求
#### 账户需求

- [x] 账户拥有名称、头像、邮箱等个人信息，邮箱唯一
- [x] 新用户注册提供名称、邮箱、密码生成账户
    - [x] 需要发送邮件防止恶意注册
- [x] 用户可以用邮箱找回账号的密码
- [x] 用户可以注销账号
- [x] 用户可以更换账号头像
- [x] 用户可以查看账户的不同难度的做题数量（已通过）
- [ ] 用户可以查看账户做题数量前20排行榜
- [x] 用户可以查看账户最近登录的ip地址
- [x] 用户可以标记是否为管理员
    - [x] 只有管理员账户可以登录管理端
    - [x] 管理员可以注销用户账号
    - [x] 管理员可以修改用户的信息与密码

#### 题目需求

- [x] 题目拥有题目名称、题目编号、做题状态（已通过、未通过、未作答）、题目难度（简单、中等、困难）、题目标签。
- [x] 用户可以通过 题目的难度、做题状态、标签进行筛选题目列表、也可以通过题目名称模糊匹配
- [x] 管理员用户可以上传题目
    - [x] 题目信息包括题目名称、难度、允许使用语言、限制资源（包括运行时间和内存）、可选标签
    - [x] 题面内容
    - [x] 判题 case，上传文件（包括输入输出文件）
- [x] 管理员用户可以编辑题目
    - [x] 控制题目的开闭状态
    
#### 判题需求

进入详细答题页

- [x] 用户可以看到题面、题目资源限制（包括运行时间和内存）、出题用户、出题时间、最新修改时间等信息。
- [x] 用户选择答题语言并填写完代码后，进行判题提交。
- [x] 判题提交会产生一条判题记录，用户可以查看本题的个人历史判题记录。
- [x] 判题记录包含用户提交的代码、判题提交时间、执行时间、内存消耗、判题状态（判题中、已完成）、判题结果（通过/未通过）、通过的case数量（按照case顺序 ），未通过显示该case 的评审状态。
- [x] 如果用户还在答题页面，当前提交的判题记录结果返回后，立即显示在页面上。
- [x] 如果用户离开答题页面，判题的流程不应当终止，用户下次进入答题页面后，可以进入判题历史记录页面显示所有的判题结果。

**评测状态**

* 编译失败 Compile Error CE
* 答案正确 Accept AC
* 答案错误 Wrong Answer WA
* 运行时错误 Runtime Error RE
* 运行超时 Time limit Exceeded TLE
* 内存超限 Memory limit Exceeded MLE
* 未知错误 Unknown Error UE

#### 比赛需求
- 赛前
    - [x] 管理员可以指定时间段内举办一场比赛，赛前用户可以报名参与，报名后也可以取消
    - [x] 只有比赛未启用状态可以对比赛进行编辑
    - [x] 比赛信息
        - [x] 比赛名称、比赛信息、举办人、举办时间、开始时间（用户不能报名/取消报名）～ 结束时间（用户不能答题/取消报名）
        - [x] 比赛选题 - 管理员可以从题库选择题目进入比赛
            - [x] 可以为选入比赛的题目设置分数
            - [x] 得分按照最终通过的样例 case 比例计算
- 赛中
    - [x] 用户不能报名/不能取消报名
    - [x] 用户通过比赛页面进入答题
    - [x] 比赛页面无法查看历史提交记录
    - [x] 比赛中提交的记录与日常判题记录分开
    - [ ] 用户报名比赛后，无法进入选入该比赛的题目页面
- 赛后
    - [x] 用户不能取消报名
    - [ ] 用户进入比赛页面只能显示自己的成绩 以及 报名用户的前10排行
    - [x] 管理员可以查看所有用户的比赛成绩
